{% include 'header.html' %}

<div class="dashboard-grid">
    <aside class="sidebar-panel">
        <div class="user-profile">
            <i class="fas fa-user-circle profile-icon"></i>
            <h3>áŠ¥áŠ•áŠ³áŠ• á‹°áˆ…áŠ“ áˆ˜áŒ¡á£ {{ user.username }}!</h3>
            <p style="color: var(--accent-color); font-weight: 700;">
                <i class="fas fa-certificate"></i> áˆ°áˆ«á‰°áŠ› (Worker)
            </p>
        </div>

        <div class="balance-summary">
            <h4><i class="fas fa-wallet"></i> á‹¨áŒˆáŠ•á‹˜á‰¥ áˆáŠ”á‰³á‹</h4>
            <div class="stat-item earned">
                <span>áŠ áŒ á‰ƒáˆ‹á‹­ áŒˆá‰¢:</span>
                <strong>á‰¥áˆ­ {{ "%.2f"|format(user.total_earned) }}</strong>
            </div>
            <div class="stat-item pending">
                <span>áˆŠá‹ˆáŒ£ á‹¨áˆšá‰½áˆ á‰€áˆª áˆ‚áˆ³á‰¥:</span>
                <strong>á‰¥áˆ­ {{ "%.2f"|format(user.pending_payout) }}</strong>
            </div>
            <a href="{{ url_for('payout_request') }}" class="btn success btn-full" style="margin-top: 15px;">
                <i class="fas fa-paper-plane"></i> áŒˆáŠ•á‹˜á‰¥ á‹­áŒ á‹­á‰
            </a>
        </div>

        <div class="quick-links">
            <h4><i class="fas fa-link"></i> áˆáŒ£áŠ• áŠ áŒˆáŠ“áŠá‰½</h4>
            <a href="#active-task">á‹¨áŠ áˆáŠ‘ áˆµáˆ«á‹¬</a>
            <a href="#task-history">á‹¨áˆ¥áˆ« á‰³áˆªáŠ­</a>
            <a href="{{ url_for('payout_request') }}">áŒˆáŠ•á‹˜á‰¥ á‹­áŒ á‹­á‰</a>
        </div>
    </aside>

    <section class="main-content">
        <h2><i class="fas fa-tasks"></i> á‹¨áˆ¥áˆ« áˆ›á‹•áŠ¨áˆ</h2>
        
        <div id="active-task" class="card task-block">
            {% if current_task %}
                <h3><i class="fas fa-cogs"></i> á‹¨áŠ áˆáŠ‘ áˆ¥áˆ«á‹</h3>
                <div class="task-details">
                    <p>
                        <strong>á‹¨áŒ‚áˆœáˆ áˆµáˆ:</strong> <span class="highlight-info">{{ current_task.gmail_username }}</span>
                    </p>
                    <p>
                        <strong>á‹¨á‹­áˆˆá á‰ƒáˆ:</strong> <span class="highlight-danger">{{ current_task.gmail_password }}</span>
                    </p>
                    {% if current_task.recovery_email %}
                    <p>
                        <strong>áˆªáŠ¨á‰¨áˆª áŠ¢áˆœáˆ:</strong> <span class="highlight-info">{{ current_task.recovery_email }}</span>
                    </p>
                    <p class="instruction" style="background-color: #fef3cd; border-left: 4px solid #ff9800; padding: 10px; border-radius: 4px;">
                        <i class="fas fa-info-circle"></i> <strong>áŠ áˆµá‰°á‹³á‹µáˆ­áŠ• á‰ </strong>á‹ˆá‹° gmail.com áˆ²áˆ„á‹± áˆªáŠ¨á‰¨áˆª áŠ¢áˆœáˆ‰áŠ• á‹«áŠ­áˆ‰/á‹«áŒ áŠ“á‰…á‰ (Recovery Email)
                    </p>
                    {% endif %}
                    <p class="instruction">
                        <i class="fas fa-exclamation-triangle"></i> á‹ˆá‹° gmail.com á‰ áˆ˜áˆ„á‹µ á‰ á‹šáˆ… áˆ˜áˆ¨áŒƒ áŠ á‹²áˆµ áŠ áŠ«á‹áŠ•á‰µ á‹­ááŒ áˆ© áŠ¥áŠ“ áŠ¢áˆœáˆ‰ á‰°áŠ¨áˆá‰° á‹ˆá‹°áˆšá‹«áˆ³á‹­ áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆáŠ©á¢
                    </p>
                </div>
                
                <form method="POST" action="{{ url_for('submit_task', task_id=current_task.id) }}" class="submission-form" enctype="multipart/form-data">
                    <label for="screenshot_upload">
                        <i class="fas fa-camera"></i> áŠ¢áˆœáˆ‰áŠ• áˆ˜áŠ¨áˆá‰±áŠ• á‹¨áˆšá‹«áˆ³á‹­ áŠ¢áˆœáˆ‰áŠ• áˆµáŠ­áˆªáŠ•áˆ»á‰µ áŠ á‹µáˆ­áŒˆá‹ á‹­áˆ‹áŠ©
                    </label>
                    <p style="font-size: 0.75em; color: var(--danger-color); margin: 8px 0; font-weight: 600;">
                        <i class="fas fa-exclamation-circle"></i> áˆ›áˆ³áˆ°á‰¢á‹« áŠ¤á‹²á‰µ áŠ¥áŠ“ áŠ­áˆ®á• áˆµáˆ«á‹áŠ• á‹á‹µá‰… á‹«áˆµá‰°áˆ­áŒ‹áˆ áŠ¥áŠ•á‹²áˆáˆ Ban á‹¨áˆµá‹°áˆ­áŒ‹áˆ
                    </p>
                    <div class="screenshot-upload-area">
                        <input type="file" id="screenshot_upload" name="screenshot" required 
                               accept="image/*" 
                               placeholder="áˆµáŠ­áˆªáŠ•áˆ»á‰µ áˆáˆ¨áŒ¥">
                        <p style="font-size: 0.9em; color: var(--text-light); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> PNG, JPG á‹ˆá‹­áˆ JPEG áˆáˆµáˆ á‹­áˆáˆ¨áŒ¡
                        </p>
                    </div>
                    <button type="submit" class="btn success btn-full">
                        <i class="fas fa-check"></i> áˆ¥áˆ«á‹¬áŠ• áŠ áˆµáˆ¨áŠ­á‰¥áŠ“ á‰¥áˆ­ 10 á‰°á‰€á‰ áˆ
                    </button>
                </form>

            {% elif available_task %}
                <h3><i class="fas fa-briefcase"></i> áŠ á‹²áˆµ áˆ¥áˆ« á‹­á‹áˆ°á‹±</h3>
                <p>áŠ áŠ•á‹µ áŠ•á‰ á‹¨áŒ‚áˆœá‹­áˆ áŠ áŠ«á‹áŠ•á‰µ áˆáŒ áˆ« áˆ¥áˆ« á‰ áŠ­áˆá‰½á‰µ á‹áˆµáŒ¥ áŠ áˆˆá¢</p>
                <form method="POST" action="{{ url_for('take_task') }}">
                    <button type="submit" class="btn primary btn-full">
                        <i class="fas fa-arrow-alt-circle-right"></i> áˆ¥áˆ«á‹áŠ• á‹­á‹áˆ°á‹± (Take Task)
                    </button>
                </form>
            {% else %}
                <h3><i class="fas fa-hourglass-half"></i> áŠ á‹²áˆµ áˆ¥áˆ« á‰ áˆ˜áŒ á‰ á‰… áˆ‹á‹­</h3>
                <p>á‰ áŠ áˆáŠ‘ áˆ°á‹“á‰µ á‰ áŠ­áˆá‰½á‰µ á‹áˆµáŒ¥ áˆáŠ•áˆ á‹¨áˆšáˆ áˆ« áˆ¥áˆ« á‹¨áˆˆáˆá¢ áŠ¥á‰£áŠ­á‹ á‰µáŠ•áˆ½ á‰†á‹­á‰°á‹ á‹­áˆ˜áˆˆáˆ±á¢</p>
                <div class="progress-bar">
                    <div class="bar-fill" style="width: 0%;"></div>
                </div>
            {% endif %}
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <!-- Daily Check-In Card -->
            <div class="featured-opportunity-section">
                <button onclick="dailyCheckin()" class="featured-card" style="background: none; border: none; cursor: pointer; width: 100%; text-align: left;">
                    <div class="featured-card-inner">
                        <div class="featured-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="featured-content">
                            <div class="featured-badge">ğŸ“… á‹•áˆˆá‰³á‹Š áˆªá‹‹áˆ­á‹µ</div>
                            <h3>á‹›áˆ¬ áŒˆá‰¡!</h3>
                            <p>á‹›áˆ¬ áŒˆá‰¥á‰°á‹ á‰¥áˆ­ 0.20 á‹«áŒáŠ™ - á‰ á‹¨á‰€áŠ‘ á‹­á‹°áŒˆáˆ›áˆ!</p>
                            <div class="featured-stats">
                                <span class="stat-badge"><i class="fas fa-star"></i> â­ á‰€áˆ‹áˆ</span>
                                <span class="stat-badge"><i class="fas fa-money-bill-alt"></i> ğŸ’° á‰¥áˆ­ 0.20</span>
                                <span class="stat-badge success-badge">âœ¨ á‰ á‹­áŠ-áˆ</span>
                            </div>
                        </div>
                        <div class="featured-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </button>
            </div>

            <!-- Video Ads Card -->
            <div class="featured-opportunity-section">
                <a href="{{ url_for('view_ads') }}" class="featured-card">
                    <div class="featured-card-inner">
                        <div class="featured-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="featured-content">
                            <div class="featured-badge">ğŸ Add to Your Total Earnings</div>
                            <h3>Earn Money by Watching Ads!</h3>
                            <p>Instant money directly to your dashboard - see withdrawal details and timing here.</p>
                            <div class="featured-stats">
                                <span class="stat-badge"><i class="fas fa-clock"></i> â± áˆáŒ£áŠ•</span>
                                <span class="stat-badge"><i class="fas fa-money-bill-alt"></i> ğŸ’° áŠ¢áŠ•áˆµá‰³áŠ•á‰µ</span>
                                <span class="stat-badge success-badge">ğŸ†• áŠ á‹²áˆµ</span>
                            </div>
                        </div>
                        <div class="featured-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        
        <div id="task-history" class="card task-history-block">
            <h3><i class="fas fa-history"></i> á‹¨áˆ¥áˆ« á‰³áˆªáŠ­á‹</h3>
            <table>
                <thead>
                    <tr>
                        <th>á‹¨áŒ‚áˆœáˆ áˆµáˆ</th>
                        <th>á‹¨á‰°áˆ˜á‹°á‰ á‰ á‰µ á‰€áŠ•</th>
                        <th>áˆáŠ”á‰³</th>
                        <th>áŠ­áá‹« ($)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in my_tasks %}
                    <tr>
                        <td>{{ task.gmail_username }}</td>
                        <td>{{ task.date_assigned.strftime('%Y-%m-%d') if task.date_assigned else 'N/A' }}</td>
                        <td>
                            <span class="status-tag {{ task.status|lower }}">
                                {% if task.status == 'PENDING' %}
                                    <i class="fas fa-spinner fa-spin"></i> á‰ áˆ˜áŒ á‰ á‰… áˆ‹á‹­
                                {% elif task.status == 'VERIFIED' %}
                                    <i class="fas fa-check-circle"></i> á‹¨á‰°áˆ¨áŒ‹áŒˆáŒ 
                                {% else %}
                                    {{ task.status }}
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            {% if task.status == 'VERIFIED' %}
                                á‰¥áˆ­ 10
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center;">áŒˆáŠ“ áˆáŠ•áˆ áˆ¥áˆ« áŠ áˆáˆ°áˆ©áˆá¢</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </section>
</div>


{% include 'footer.html' %}

<script>
function dailyCheckin() {
    fetch('{{ url_for("daily_checkin") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // Refresh the page to update balance
            location.reload();
        } else {
            alert('âŒ ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error performing daily check-in');
    });
}
</script>

<style>
/* --- Featured Opportunity Section --- */
.featured-opportunity-section {
    margin: 30px 0;
    animation: fadeInScale 0.6s ease-out;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.featured-card {
    display: block;
    text-decoration: none;
    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDB833 100%);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3), 0 0 40px rgba(255, 183, 51, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: translateY(0);
}

.featured-card:hover {
    transform: translateY(-12px);
    box-shadow: 0 16px 48px rgba(255, 107, 53, 0.4), 0 0 60px rgba(255, 183, 51, 0.25);
}

.featured-card:active {
    transform: translateY(-6px);
}

.featured-card-inner {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 24px;
    align-items: center;
    padding: 28px 32px;
    color: white;
    position: relative;
    z-index: 1;
}

@media (max-width: 600px) {
    .featured-card-inner {
        grid-template-columns: auto 1fr;
        gap: 16px;
        padding: 20px;
    }
}

.featured-icon {
    font-size: 3.5em;
    min-width: 70px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 12px;
    width: 70px;
    height: 70px;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
}

.featured-content {
    flex: 1;
}

.featured-badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.3);
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 700;
    margin-bottom: 8px;
    backdrop-filter: blur(10px);
}

.featured-content h3 {
    font-size: 1.5em;
    margin: 8px 0;
    font-weight: 800;
    letter-spacing: -0.5px;
}

.featured-content p {
    font-size: 0.95em;
    opacity: 0.95;
    margin: 8px 0 12px 0;
    line-height: 1.4;
}

.featured-stats {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.stat-badge {
    background: rgba(255, 255, 255, 0.25);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.85em;
    font-weight: 600;
    white-space: nowrap;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.stat-badge i {
    margin-right: 4px;
}

.success-badge {
    background: rgba(76, 175, 80, 0.3);
    border-color: rgba(76, 175, 80, 0.5);
}

.featured-arrow {
    font-size: 1.8em;
    opacity: 0.8;
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.featured-card:hover .featured-arrow {
    transform: translateX(8px);
    opacity: 1;
}

@media (max-width: 600px) {
    .featured-arrow {
        display: none;
    }
}

/* --- Dashboard Layout --- */
.dashboard-grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 30px;
    margin-top: 30px;
}

@media (max-width: 900px) {
    .dashboard-grid {
        grid-template-columns: 1fr; /* áˆˆá‰µáŠ•áŠ•áˆ½ áˆµáŠ­áˆªáŠ–á‰½ á‰ áŠ á‰€á‰£á‹Š á‹­á‹°áˆ¨á‹°áˆ«áˆ */
    }
    .sidebar-panel {
        order: -1; /* áˆ³á‹­á‹µá‰£áˆ© áˆ˜áŒ€áˆ˜áˆªá‹« áŠ¥áŠ•á‹²áˆ˜áŒ£ */
    }
}

/* --- Sidebar Panel --- */
.sidebar-panel {
    background: var(--white);
    padding: 20px;
    border-radius: 12px;
    box-shadow: var(--shadow-md);
    height: fit-content;
}

.user-profile {
    text-align: center;
    border-bottom: 1px solid var(--border-light);
    padding-bottom: 20px;
    margin-bottom: 20px;
}
.profile-icon {
    font-size: 4em;
    color: var(--secondary-color);
    margin-bottom: 10px;
}
.user-profile h3 {
    margin-bottom: 5px;
    font-size: 1.5em;
}

.balance-summary h4, .quick-links h4 {
    color: var(--primary-color);
    border-bottom: 2px solid var(--accent-color);
    padding-bottom: 8px;
    margin-bottom: 15px;
    font-size: 1.1em;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed var(--border-light);
    font-size: 1.1em;
}
.stat-item strong {
    font-weight: 800;
}
.earned strong { color: var(--accent-color); }
.pending strong { color: var(--warning-color); }

.quick-links a {
    display: block;
    padding: 8px 0;
    font-weight: 500;
    border-bottom: