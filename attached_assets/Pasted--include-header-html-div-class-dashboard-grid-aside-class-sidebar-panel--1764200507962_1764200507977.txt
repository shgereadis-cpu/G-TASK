{% include 'header.html' %}

<div class="dashboard-grid">
    <aside class="sidebar-panel">
        <div class="user-profile">
            <i class="fas fa-user-circle profile-icon"></i>
            <h3>ріЦріЋрі│ріЋ рІ░рѕЁріЊ рѕўрїАрЇБ {{ user.username }}!</h3>
            <p style="color: var(--accent-color); font-weight: 700;">
                <i class="fas fa-certificate"></i> рѕ░рѕФрЅ░ріЏ (Worker)
            </p>
        </div>

        <div class="balance-summary">
            <h4><i class="fas fa-wallet"></i> рІерїѕріЋрІўрЅЦ рѕЂріћрЅ│рІј</h4>
            <div class="stat-item earned">
                <span>ріарїарЅЃрѕІрІГ рїѕрЅб:</span>
                <strong>рЅЦрѕГ {{ "%.2f"|format(user.total_earned) }}</strong>
            </div>
            <div class="stat-item pending">
                <span>рѕірІѕрїБ рІерѕџрЅйрѕЇ рЅђрѕф рѕѓрѕ│рЅЦ:</span>
                <strong>рЅЦрѕГ {{ "%.2f"|format(user.pending_payout) }}</strong>
            </div>
            <a href="{{ url_for('payout_request') }}" class="btn success btn-full" style="margin-top: 15px;">
                <i class="fas fa-paper-plane"></i> рїѕріЋрІўрЅЦ рІГрїарІГрЅЂ
            </a>
        </div>

        <div class="quick-links">
            <h4><i class="fas fa-link"></i> рЇѕрїБріЋ ріарїѕріЊріърЅй</h4>
            <a href="#active-task">рІеріарѕЂріЉ рѕхрѕФрІг</a>
            <a href="#task-history">рІерѕЦрѕФ рЅ│рѕфріГ</a>
            <a href="{{ url_for('payout_request') }}">рїѕріЋрІўрЅЦ рІГрїарІГрЅЂ</a>
        </div>
    </aside>

    <section class="main-content">
        <h2><i class="fas fa-tasks"></i> рІерѕЦрѕФ рѕЏрІЋріерѕЇ</h2>
        
        <div id="active-task" class="card task-block">
            {% if current_task %}
                {% set item = current_task.inventory_item %}
                
                <h3><i class="fas fa-cogs"></i> рІеріарѕЂріЉ рѕЦрѕФрІј</h3>
                
                <div class="task-details">
                    {% if item %}
                        <p>
                            <strong>рІерїѓрѕюрѕЇ рѕхрѕЮ:</strong> <span class="highlight-info">{{ item.gmail_username }}</span>
                        </p>
                        <p>
                            <strong>рІерІГрѕѕрЇЇ рЅЃрѕЇ:</strong> <span class="highlight-danger">{{ item.gmail_password }}</span>
                        </p>
                        
                        {% if item.recovery_email %}
                        <p>
                            <strong>рѕфріерЅерѕф рібрѕюрѕЇ:</strong> <span class="highlight-info">{{ item.recovery_email }}</span>
                        </p>
                        <p class="instruction" style="background-color: #fef3cd; border-left: 4px solid #ff9800; padding: 10px; border-radius: 4px;">
                            <i class="fas fa-info-circle"></i> <strong>ріарѕхрЅ░рІ│рІхрѕГріЋ рЅа</strong>рІѕрІ░ gmail.com рѕ▓рѕёрІ▒ рѕфріерЅерѕф рібрѕюрѕЅріЋ рІФріГрѕЅ/рІФрїаріЊрЅЁрЅЂ (Recovery Email)
                        </p>
                        {% endif %}
                        
                        <p class="instruction">
                            <i class="fas fa-exclamation-triangle"></i> рІѕрІ░ gmail.com рЅарѕўрѕёрІх рЅарІџрѕЁ рѕўрѕерїЃ ріарІ▓рѕх ріаріФрІЇріЋрЅх рІГрЇЇрїарѕЕ ріЦріЊ рібрѕюрѕЅ рЅ░ріерЇѕрЅ░ рІѕрІ░рѕџрІФрѕ│рІГ рѕхріГрѕфріЋрѕ╗рЅх рІГрѕЇріЕрЇб
                        </p>
                    {% else %}
                        <p class="instruction" style="background-color: #fef3cd; border-left: 4px solid #ff9800; padding: 10px; border-radius: 4px;">
                            <i class="fas fa-exclamation-triangle"></i> рІерѕЦрѕФрІЇ рІЮрѕГрІЮрѕГ (Inventory Item) ріерІ│рЅ│рЅцрІЮ рѕІрІГ ріарѕЇрЅ░рїѕріўрѕЮрЇб ріЦрЅБріГрІј ріарѕхрЅ░рІ│рІ│рѕфріЋ рІФріљрїІрїЇрѕЕрЇб
                        </p>
                    {% endif %}
                </div>
                
                <form method="POST" action="{{ url_for('submit_task', task_id=current_task.id) }}" class="submission-form" enctype="multipart/form-data">
                    <label for="screenshot_upload">
                        <i class="fas fa-camera"></i> рібрѕюрѕЅріЋ рѕўріерЇѕрЅ▒ріЋ рІерѕџрІФрѕ│рІГ рібрѕюрѕЅріЋ рѕхріГрѕфріЋрѕ╗рЅх ріарІхрѕГрїѕрІЇ рІГрѕІріЕ
                    </label>
                    <p style="font-size: 0.75em; color: var(--danger-color); margin: 8px 0; font-weight: 600;">
                        <i class="fas fa-exclamation-circle"></i> рѕЏрѕ│рѕ░рЅбрІФ ріцрІ▓рЅх ріЦріЊ ріГрѕ«рЇЋ рѕхрѕФрІЇріЋ рІЇрІхрЅЁ рІФрѕхрЅ░рѕГрїІрѕЇ ріЦріЋрІ▓рѕЂрѕЮ Ban рІерѕхрІ░рѕГрїІрѕЇ
                    </p>
                    <div class="screenshot-upload-area">
                        <input type="file" id="screenshot_upload" name="screenshot" required 
                               accept="image/*" 
                               placeholder="рѕхріГрѕфріЋрѕ╗рЅх рѕЮрѕерїЦ">
                        <p style="font-size: 0.9em; color: var(--text-light); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> PNG, JPG рІѕрІГрѕЮ JPEG рѕЮрѕхрѕЇ рІГрѕЮрѕерїА
                        </p>
                    </div>
                    <button type="submit" class="btn success btn-full">
                        <i class="fas fa-check"></i> рѕЦрѕФрІгріЋ ріарѕхрѕеріГрЅЦріЊ рЅЦрѕГ 10 рЅ░рЅђрЅарѕЇ
                    </button>
                </form>

            {% elif available_task %}
                <h3><i class="fas fa-briefcase"></i> ріарІ▓рѕх рѕЦрѕФ рІГрІЇрѕ░рІ▒</h3>
                <p>ріаріЋрІх ріЋрЅЂ рІерїѓрѕюрІГрѕЇ ріаріФрІЇріЋрЅх рЇѕрїарѕФ рѕЦрѕФ рЅаріГрѕЮрЅйрЅх рІЇрѕхрїЦ ріарѕѕрЇб</p>
                <form method="POST" action="{{ url_for('take_task') }}">
                    <button type="submit" class="btn primary btn-full">
                        <i class="fas fa-arrow-alt-circle-right"></i> рѕЦрѕФрІЇріЋ рІГрІЇрѕ░рІ▒ (Take Task)
                    </button>
                </form>
            {% else %}
                <h3><i class="fas fa-hourglass-half"></i> ріарІ▓рѕх рѕЦрѕФ рЅарѕўрїарЅарЅЁ рѕІрІГ</h3>
                <p>рЅаріарѕЂріЉ рѕ░рІЊрЅх рЅаріГрѕЮрЅйрЅх рІЇрѕхрїЦ рѕЮріЋрѕЮ рІерѕџрѕарѕФ рѕЦрѕФ рІерѕѕрѕЮрЇб ріЦрЅБріГрІј рЅхріЋрѕй рЅєрІГрЅ░рІЇ рІГрѕўрѕѕрѕ▒рЇб</p>
                <div class="progress-bar">
                    <div class="bar-fill" style="width: 0%;"></div>
                </div>
            {% endif %}
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div class="featured-opportunity-section">
                <button onclick="dailyCheckin()" class="featured-card" style="background: none; border: none; cursor: pointer; width: 100%; text-align: left;">
                    <div class="featured-card-inner">
                        <div class="featured-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="featured-content">
                            <div class="featured-badge">­ЪЊЁ рІЋрѕѕрЅ│рІі рѕфрІІрѕГрІх</div>
                            <h3>рІЏрѕг рїѕрЅА!</h3>
                            <p>рІЏрѕг рїѕрЅЦрЅ░рІЇ рЅЦрѕГ 0.20 рІФрїЇріЎ - рЅарІерЅђріЉ рІГрІ░рїѕрѕЏрѕЇ!</p>
                            <div class="featured-stats">
                                <span class="stat-badge"><i class="fas fa-star"></i> РГљ рЅђрѕІрѕЇ</span>
                                <span class="stat-badge"><i class="fas fa-money-bill-alt"></i> ­Ъњ░ рЅЦрѕГ 0.20</span>
                                <span class="stat-badge success-badge">Рюе Instant</span>
                            </div>
                        </div>
                        <div class="featured-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </button>
            </div>

            <div class="featured-opportunity-section">
                <a href="{{ url_for('view_ads') }}" class="featured-card">
                    <div class="featured-card-inner">
                        <div class="featured-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="featured-content">
                            <div class="featured-badge">­ЪјЂ Add to Your Total Earnings</div>
                            <h3>Earn Money by Watching Ads!</h3>
                            <p>Instant money directly to your dashboard - see withdrawal details and timing here.</p>
                            <div class="featured-stats">
                                <span class="stat-badge"><i class="fas fa-clock"></i> РЈ▒ рЇѕрїБріЋ</span>
                                <span class="stat-badge"><i class="fas fa-money-bill-alt"></i> ­Ъњ░ рібріЋрѕхрЅ│ріЋрЅх</span>
                                <span class="stat-badge success-badge">­ЪєЋ ріарІ▓рѕх</span>
                            </div>
                        </div>
                        <div class="featured-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        
        <div id="task-history" class="card task-history-block">
            <h3><i class="fas fa-history"></i> рІерѕЦрѕФ рЅ│рѕфріГрІј</h3>
            <table>
                <thead>
                    <tr>
                        <th>рІерїѓрѕюрѕЇ рѕхрѕЮ</th>
                        <th>рІерЅ░рѕўрІ░рЅарЅарЅх рЅђріЋ</th>
                        <th>рѕЂріћрЅ│</th>
                        <th>ріГрЇЇрІФ ($)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in my_tasks %}
                    <tr>
                        <td>
                            {% if task.inventory_item %}
                                {{ task.inventory_item.gmail_username }}
                            {% else %}
                                N/A (рІерЅ░рѕ░рѕерІў)
                            {% endif %}
                        </td>
                        <td>{{ task.date_assigned.strftime('%Y-%m-%d') if task.date_assigned else 'N/A' }}</td>
                        <td>
                            <span class="status-tag {{ task.status|lower }}">
                                {% if task.status == 'PENDING' %}
                                    <i class="fas fa-spinner fa-spin"></i> рЅарѕўрїарЅарЅЁ рѕІрІГ
                                {% elif task.status == 'VERIFIED' %}
                                    <i class="fas fa-check-circle"></i> рІерЅ░рѕерїІрїѕрїа
                                {% else %}
                                    {{ task.status }}
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            {% if task.status == 'VERIFIED' %}
                                рЅЦрѕГ 10
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center;">рїѕріЊ рѕЮріЋрѕЮ рѕЦрѕФ ріарѕЇрѕ░рѕЕрѕЮрЇб</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </section>
</div>

{% include 'footer.html' %}

<script>
function dailyCheckin() {
    fetch('{{ url_for("daily_checkin") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('РЮї ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error performing daily check-in');
    });
}
</script>

<style>
/* CSS styles remain the same */
.featured-opportunity-section {
    margin: 30px 0;
    animation: fadeInScale 0.6s ease-out;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.featured-card {
    display: block;
    text-decoration: none;
    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDB833 100%);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3), 0 0 40px rgba(255, 183, 51, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: translateY(0);
}

.featured-card:hover {
    transform: translateY(-12px);
    box-shadow: 0 16px 48px rgba(255, 107, 53, 0.4), 0 0 60px rgba(255, 183, 51, 0.25);
}

.featured-card:active {
    transform: translateY(-6px);
}

.featured-card-inner {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 24